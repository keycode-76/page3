import{u as q,l as St}from"./index-DMd0utxA.js";const Cn={Flint_stone:{low:5,high:15,limit:10,is:"attack",attack:1},Bone_piece:{low:5,high:15,limit:5,is:"attack",attack:2},Fur_pelt:{low:5,high:15,limit:10,is:"attack",attack:1},Glass_bottle:{low:5,high:15,limit:5,is:"attack",attack:2},Raw_meat:{low:5,high:15,limit:5,is:"heal",heal:1},Extra_pocket:{low:10,high:20,limit:2,is:"attack",attack:1},Meat_soup:{low:10,high:20,limit:5,is:"heal",heal:4}},Nn={title:{Flint_stone:"Flint Stone",Bone_piece:"Bone Piece",Fur_pelt:"Fur Pelt",Glass_bottle:"Glass Bottle",Raw_meat:"Raw Meat",Extra_pocket:"Extra pocket",Meat_soup:"Meat Soup",Entrance:"Entrance",Team_leader:"Team leader"},info:{0:"Base",Flint_stone:"A useful material for starting fires.",Bone_piece:"Easily found on the ground, can cause damage.",Fur_pelt:"A useful material.",Glass_bottle:"An empty glass jar, can cause damage.",Raw_meat:"Unidentified meat, edible.",Extra_pocket:"A larger space for pocket",Meat_soup:"A strong-smelling soup, edible.",Entrance:"Entrance",Team_leader:"Team_leader",path:"Path",mechanic:"Mechanic"}},Tn={title:{Flint_stone:"打火石",Bone_piece:"骨頭碎片",Fur_pelt:"毛皮",Glass_bottle:"玻璃瓶",Raw_meat:"生肉",Extra_pocket:"擴增口袋",Meat_soup:"肉湯"},info:{0:"基地",Flint_stone:"有用的材料，用來生火",Bone_piece:"地上隨手可得，可以造成傷害",Fur_pelt:"有用的材料",Glass_bottle:"空的玻璃罐子，可以造成傷害",Raw_meat:"不知道是誰的肉，可食用",Extra_pocket:"增加口袋容量兩格",Meat_soup:"腥味很重的湯，可食用",Entrance:"入口",Team_leader:"組長",path:"通道",mechanic:"技師"}},g={effects:Cn,EN:Nn,CH:Tn};let e={now_end:0,start_locat:{},ends_collect:{},golbal_arr:{},map:[],scene_arr:{},line_arr:[],npc_line:[],harvey_line:[],hospital_line:[],last_scene_index:0,line_id:0,line_length:0,line_rp:[],wall:1,now_scene_data:{},sceneIndex:0,now_click_data:{},heart:20,sanity:20,heart_limit:30,sanity_limit:20,money:20,bag_space:10,inventory_space:20,trust:{base:300,harvey:0,painter:0},bag:[{name:"Meat_soup",quantity:5},{name:"Flint_stone",quantity:3},{name:"Bone_piece",quantity:3},{name:"Raw_meat",quantity:1},{name:"Raw_meat",quantity:5},{name:"Raw_meat",quantity:2}],album:[{name:"Entrance"},{name:"Team_leader"}],enemy:{heart:0,harm:0,neft_burn:0,nerf_infect:0,nerf_phonophobia:0,buff_carapace:0,buff_flexibility:0,buff_anger:0},weapon_feature:{Parasite_bullet:1,Glare_bullet:1,Corrosion_bullet:1}};const re=document.querySelector("#screen"),T=document.querySelector("#screen_bg"),j=document.querySelector("#scene_bg"),Z=document.querySelector("#scene_ux"),M=document.querySelector("#screen_cover"),v=document.querySelector("#screen_ui"),Ie=a("pop_note"),ia=a("next_scene_btn"),de=a("end_div"),Wt=a("end_img"),qe=a("end_label"),Ye=document.querySelector("#end_retry");de.append(Wt,qe,Ye);const Te=a("lines_div"),qt=a("lines_name"),Mt=a("lines_text"),It=a("lines_btn"),S=a("lines_pass_btn");let f="",Rt;const Bt=a("user_locate_div"),x=a("mini_map_div"),Re=a("user_map_compass"),ie=a("map_tile_container"),U=a("mini_map_padder"),Be=a("full_map_div"),oe=a("full_map_padder"),Ft=a("map_compress_div"),Ot=a("map_compress_N","map_compresses"),At=a("map_compress_E","map_compresses"),Pt=a("map_compress_S","map_compresses"),Gt=a("map_compress_W","map_compresses");Ot.textContent="N";At.textContent="E";Pt.textContent="S";Gt.textContent="W";const Dt=a("map_full_container"),Qt=a("map_locat_title"),at=a("map_locat_info"),Yt=a("map_btn_container"),Vt=a("map_right_btn","map_btns"),Ut=a("map_left_btn","map_btns"),Xt=a("map_up_btn","map_btns"),zt=a("map_down_btn","map_btns"),Jt=a("map_now_btn","map_btns"),Kt=a("map_close_btn","map_btns");Yt.append(Vt,Ut,Xt,zt,Jt,Kt);Dt.append(Yt,Qt,at);Ft.append(Ot,At,Pt,Gt);Be.append(oe,Ft,Dt);Bt.append(Re,x);x.appendChild(U);const Ze="L";let _,k={x:0,y:0},l={N:0,E:0,S:0,W:0,gap:3},w={right:0,left:0,up:0,down:0,gap:2.2},le=[];const jn=a("hand_left"),Fe=a("user_hand"),$n=a("flash"),Q=a("covered_in_blood"),X=a("state_efx"),qn=a("btn_return","ui_btns"),Zt=a("btn_left","ui_btns"),en=a("btn_right","ui_btns"),st=a("btn_forward","ui_btns");let r,ut=!1;const z=a("user_states_div"),Me=a("user_heart_contain","user_state_contain"),ce=a("user_sanity_contain","user_state_contain"),tn=a("btn_album"),nn=a("btn_bag"),N=a("item_operation_panel"),I=a("facility_div"),W=a("facility_box"),ne=a("facility_title","all_titles"),H=a("facility_trust");ne.textContent="facility";I.append(ne,H,W);const an=a(0,"box_div"),He=a(0,"box_inventory"),sn=a("bag_title","all_titles");an.append(sn,He);const pe=a("bag_close_panel"),Mn=a("reject_reward_btn");let Oe=!1,Se=0;const on=a(0,"box_div"),it=a(0,"box_inventory"),ln=a("album_title","all_titles");on.append(ln,it);const y=a("object_div"),K=a("object_left_div"),Hn=a("object_top_area"),Sn=a("object_upgrade_btn"),Ae=a("object_title","all_titles"),Ht=a("object_label"),J=a("object_right_div"),E=a("object_trade_div"),cn=a("object_counter"),_n=a("object_num_add"),rn=a("object_num_sub"),ft=a("object_num_text");cn.append(rn,ft,_n);const bt=a("object_buy_btn","object_btns"),ht=a("object_sell_btn","object_btns"),Ve=a("object_take_btn","object_btns"),yt=a("object_delet_btn","object_btns"),gt=a("object_use_btn","object_btns"),Wn=a("object_give_btn","object_btns"),we=a("object_album_img"),vt=a("object_ask_btn","object_btns");let p,wt;const xt={Flint_stone:2,Bone_piece:2,Fur_pelt:2,Glass_bottle:3,Raw_meat:3},V={Meat_soup:{1:[{name:"Raw_meat",quantity:3}],2:[{name:"Raw_meat",quantity:1}],3:[{name:"Raw_meat",quantity:2}]},Extra_pocket:{1:[{name:"Raw_meat",quantity:2},{name:"Fur_pelt",quantity:1}],2:[{name:"Raw_meat",quantity:2},{name:"Bone_piece",quantity:1}]}},Le={Flint_stone:3,Bone_piece:4,Fur_pelt:3,Glass_bottle:5,Raw_meat:5},_e=[{name:"Raw_meat",quantity:5}];let Ue=!1,Xe=!1;const We=a("battle_div"),In=a("battle_light"),D=a("battle_enemy_img"),dn=a("enemy_move_div"),mn=a("enemy_now_move"),pn=a("enemy_pre_move"),un=a("enemy_next_move"),fn=a("enemy_heart_div"),bn=a("enemy_heart_bar"),Rn=a("enemy_heart_remain"),Pe=a("enemy_heart_label"),Ge=a("enemy_harm_div"),ot=a(0,"harm_note"),De=a("user_harm_div"),ge=a(0,"harm_note"),Bn=a("attack_div");let G,je=0,F;dn.append(pn,mn,un);bn.appendChild(Rn);fn.append(bn,Pe);const $=a("weapon_column"),he=a("weapon_holster_1","weapon_holster"),ye=a("weapon_holster_2","weapon_holster"),$e=a("weapon_holster_3","weapon_holster"),et=a("weapon_information"),hn=a("weapon_title"),yn=a("weapon_label"),Fn=5;function On(){let t=St[q];S.textContent=t.lines_pass_btn,Mn.textContent=t.reject_reward_btn,Ye.textContent=t.end_retry,sn.textContent=t.bag_title,ln.textContent=t.album_title,Qt.textContent=t.map_locat_title,bt.textContent=t.object_buy_btn,ht.textContent=t.object_sell_btn,Ve.textContent=t.object_take_btn,gt.textContent=t.object_use_btn,yt.textContent=t.object_delet_btn,Wn.textContent=t.object_give_btn,vt.textContent=t.object_ask_btn}On();vn();const gn=(t,n)=>{if(j.innerHTML="",Z.innerHTML="",v.innerHTML="",M.innerHTML="",f="",xe=!1,n?e.now_scene_data=n[t]:e.now_scene_data=e.scene_arr[t],!!e.now_scene_data){if(e.now_scene_data.bg&&(j.className=e.now_scene_data.bg),e.line_arr[t]&&(e.line_length=e.line_arr[t].length),!e.now_scene_data.is&&typeof e.sceneIndex=="number"?(e.sceneIndex+=1,e.last_scene_index=e.sceneIndex):e.now_scene_data.is&&(e.now_scene_data.is==="return"&&(e.now_scene_data.is=e.last_scene_index),e.sceneIndex=e.now_scene_data.is),e.now_scene_data.efx)switch(e.now_scene_data.efx){case"dark":Pn();break}switch(e.now_scene_data.type){case"anim":Lt(),j.addEventListener("animationend",s=>{s.animationName===e.now_scene_data.bg&&e.now_scene_data.type==="anim"&&(j.className="",C(e.sceneIndex))});break;case"line":e.now_scene_data.lyric?(e.line_length=Object.keys(e[`${e.now_scene_data.lyric}_line`][t]).length,e.line_rp=e[`${e.now_scene_data.lyric}_line`][t],A(e.line_length)):(e.line_length=Object.keys(e.line_arr[t]).length,e.line_rp=e.line_arr[t],A());break;case"close":e.line_length=0,A();break;case"view":e.line_length=0,A();break;case"room":switch(_){case"N":j.className=e.now_scene_data.bg[_];break;case"E":j.className=e.now_scene_data.bg[_];break;case"S":j.className=e.now_scene_data.bg[_];break;case"W":j.className=e.now_scene_data.bg[_];break}A();break;case"end":re.appendChild(de),Vn(e.now_scene_data.dead);break}}},A=()=>{var t;if(v.innerHTML="",e.line_rp&&e.line_length>0)Te.innerHTML="",Mt.textContent=e.line_rp[e.line_id],f!==""&&(qt.textContent=f,Te.appendChild(qt)),Te.append(Mt,It,S),v.appendChild(Te),e.line_id+=1,e.line_length-=1;else{switch(e.line_id=0,ae(!0),(t=e.now_scene_data)!=null&&t.btn&&e.now_scene_data.btn[_]&&v.appendChild(st),v.append(Zt,en,N),Ee(),v.appendChild(Bt),e.now_scene_data.type){case"line":e.now_scene_data.reward?Ce(e.now_scene_data.reward):C(e.sceneIndex);break;case"close":Y(),render_btn_return();break;case"view":e.now_scene_data.ux&&(e.now_scene_data.ux.some(n=>n.type==="enemy")&&v.removeChild(st),Y());break;case"room":if(e.now_scene_data.ux&&e.now_scene_data.ux)switch(_){case"N":e.now_scene_data.btn.N&&Y();break;case"E":e.now_scene_data.btn.E&&Y();break;case"S":e.now_scene_data.btn.S&&Y();break;case"W":e.now_scene_data.btn.W&&Y();break}e.now_scene_data[_]&&Y(_);break}Se&&(Ce(Se),Se=0,Lt("add"))}},Y=t=>{Z.innerHTML="";let n;t?n=e.now_scene_data[t]:n=e.now_scene_data.ux,n&&n.forEach((s,i)=>{const o=document.createElement("div");o.className="ux_btns",Z.appendChild(o),o.style.left=s.x!==void 0?s.x+"vh":"0",o.style.top=s.y!==void 0?s.y+"vh":"0",o.style.width=s.w!==void 0?s.w+"vh":"100%",o.style.height=s.h!==void 0?s.h+"vh":"100%",s.type==="merch"&&(o.style.zIndex="10"),(s.type==="enemy"||s.type==="npc")&&(f=s.name),s.bg&&s.type!=="merch"&&o.classList.add(s.bg),o.addEventListener("click",m=>{An(m,s)})})};let tt="",L=0;const An=(t,n,s)=>{switch(e.now_click_data=n,Z.children[0].style.pointerEvents="auto",ae(!1),n.type){case"unique":n.who&&(f=n.who);const i={craft:Kn,shop:Zn,inventory:ea,sharebox:ta};i.hasOwnProperty(n.is)?i[n.is]():console.log("No matching function for:",n.is);break;case"next":n.wall&&(e.wall=n.wall),e.sceneIndex=n.is,C(n.is);break;case"item":if(tt)return;tt=t,n.bg==="Impurity_crystal"?e.bag.E6D_bullet!==void 0?(jn.className="fire_E6D_bullet",setTimeout(()=>{Ce(n.reward)},500)):d("E6D bullet not enought"):Ce(n.reward);break;case"npc":e.line_length=Object.keys(e[`${n.lyric}_line`][n.is]).length,e.line_rp=e[`${n.lyric}_line`][n.is],A(e.line_length),n.reward&&(Se=n.reward,delete n.reward),n.change&&(e.scene_arr[e.sceneIndex][_]=n.change);break;case"enemy":case"boss":L=n,Un(),ke(),Z.children[0].style.display="none",tt=t;break;case"choice":Jn(n.is);break}};function vn(){kt(),e.heart=e.heart_limit,_="N",l={N:0,E:0,S:0,W:0,gap:3},U.style.padding="0vh",x.style.transform="rotate(0deg)",setTimeout(()=>{k.x=e.start_locat.x,k.y=e.start_locat.y,le.push({x:e.start_locat.x,y:e.start_locat.y}),ze()},1e3)}function kt(){clearTimeout(F)}let xe=!1;const C=t=>{xe||(xe=!0,T.className="fade_out_anim",v.className="fade_out_anim",T.addEventListener("transitionend",function n(s){s.propertyName==="opacity"&&T.classList.contains("fade_out_anim")&&(T.className="fade_in_anim",v.className="fade_in_anim",gn(t),T.addEventListener("transitionend",function i(o){o.propertyName==="opacity"&&T.classList.contains("fade_in_anim")&&(T.className="",v.className="",xe=!1,T.removeEventListener("transitionend",i))}),T.removeEventListener("transitionend",n))}))},lt=t=>{M.appendChild(Q),t==="blood"?Q.className=Math.random()<.5?"blood_1":"blood_2":t==="dead"&&(Q.className="dead_efx"),Q.addEventListener("animationend",function(){M.contains(Q)&&(Q.className="",M.removeChild(Q)),t==="dead"&&gn("dead")},{once:!0})},Pn=()=>{M.innerHTML="",M.append($n)};let ee=!1,te=[];function ze(){U.appendChild(ie),ie.innerHTML="",ie.style.gridTemplateColumns=`repeat(${e.map[0].length}, 1vh)`;for(let t=0;t<e.map.length;t++)for(let n=0;n<e.map[t].length;n++){const s=document.createElement("div");s.className="tile",s.id=`cell_${t}_${n}`,e.map[t][n]!=="x_0000"&&s.classList.add("path"),e.map[t][n].includes(Ze)&&s.classList.add("landmark"),n===k.x&&t===k.y&&(s.classList.add("map_player"),s.classList.contains("landmark")&&(ee=!1,e.sanity=e.sanity_limit)),ee&&n===te[0].x&&t===te[0].y&&(s.classList.add("map_sanity"),n===k.x&&t===k.y&&(s.classList.remove("map_sanity"),console.log("1"))),!le.some(o=>o.x===n&&o.y===t)&&e.map[t][n]!=="x_0000"&&s.classList.add("unvisited"),ie.appendChild(s),s.addEventListener("click",()=>{e.map[t][n].includes(Ze)?at.textContent=g[q].info[e.map[t][n].split(Ze)[1]]:at.textContent=g[q].info.path})}}function Gn(t){switch(t){case"N":return{x:0,y:-1};case"E":return{x:1,y:0};case"S":return{x:0,y:1};case"W":return{x:-1,y:0}}}function wn(){const t=Gn(_),n=k.x+t.x,s=k.y+t.y;if(ee&&xn(),s>=0&&s<e.map.length&&n>=0&&n<e.map[s].length&&e.map[s][n]!=="x_0000"){let m=function(u){const b=new Set;for(const be of u){const $t=`${be.x},${be.y}`;b.has($t)||(b.add($t),o.push(be))}le=o};k.x=n,k.y=s,!le.some(u=>u.x===n&&u.y===s)&&e.sanity>0&&(e.sanity-=1,e.sanity<=0&&(Qn(),document.querySelector("#user_sanity_icon").className="sanity_danger")),le.push({x:n,y:s});const o=[];m(le);let c=l.gap;switch(_){case"N":l.S>=l.gap?l.S-=l.gap:l.S>0?(c=l.gap-l.S,l.S=0,l.N+=c):l.N+=l.gap;break;case"W":l.W>=l.gap?l.W-=l.gap:l.W>0?(c=l.gap-l.W,l.W=0,l.E+=c):l.E+=l.gap;break;case"S":l.N>=l.gap?l.N-=l.gap:l.N>0?(c=l.gap-l.N,l.N=0,l.S+=c):l.S+=l.gap;break;case"E":l.E>=l.gap?l.E-=l.gap:l.E>0?(c=l.gap-l.E,l.E=0,l.N+=c):l.W+=l.gap;break}U.style.paddingTop=`${l.N}vh`,U.style.paddingLeft=`${l.E}vh`,U.style.paddingBottom=`${l.S}vh`,U.style.paddingRight=`${l.W}vh`,e.map[s][n].includes("final station")&&alert("Win!")}ze()}function ue(t){switch(t){case"right":w.right+=10;break;case"left":w.left+=10;break;case"up":w.up+=10;break;case"down":w.down+=10;break;case"now":w.right=0,w.left=0,w.up=0,w.down=0;break}oe.style.paddingTop=`${w.up+l.N*w.gap}vh`,oe.style.paddingLeft=`${w.left+l.E*w.gap}vh`,oe.style.paddingBottom=`${w.down+l.S*w.gap}vh`,oe.style.paddingRight=`${w.right+l.W*w.gap}vh`}Vt.addEventListener("click",()=>{ue("left")});Ut.addEventListener("click",()=>{ue("right")});Xt.addEventListener("click",()=>{ue("up")});zt.addEventListener("click",()=>{ue("down")});Jt.addEventListener("click",()=>{ue("now")});x.addEventListener("click",()=>{v.appendChild(Be),oe.appendChild(ie),ie.style.gridTemplateColumns=`repeat(${e.map[0].length}, 3vh)`,ue("now"),ae(!1)});Kt.addEventListener("click",()=>{v.contains(Be)&&v.removeChild(Be),ze(),ae(!0)});function Dn(t){const n={N:{left:"W",right:"E",turn_left:90,turn_right:-90},E:{left:"N",right:"S",turn_left:0,turn_right:180},S:{left:"E",right:"W",turn_left:-90,turn_right:90},W:{left:"S",right:"N",turn_left:180,turn_right:0}};t==="left"?(_==="N"?x.className="rotate_L_N":_==="E"?x.className="rotate_L_E":_==="S"?x.className="rotate_L_S":_==="W"&&(x.className="rotate_L_W"),x.style.transform=`rotate(${n[_].turn_left}deg)`,_=n[_].left):(_==="N"?x.className="rotate_R_N":_==="E"?x.className="rotate_R_E":_==="S"?x.className="rotate_R_S":_==="W"&&(x.className="rotate_R_W"),x.style.transform=`rotate(${n[_].turn_right}deg)`,_=n[_].right),x.addEventListener("animationend",()=>{x.className=""}),Re.addEventListener("animationend",()=>{Re.className=""}),ze()}const Qe=t=>{if(ee&&(xn(),te[0].x===k.x&&te[0].y===k.y)){ee=!1,e.sanity=e.sanity_limit,kt(),lt("dead");return}C(e.sceneIndex),Dn(t)};qn.addEventListener("click",()=>{C(e.now_scene_data.btn.B)});Zt.addEventListener("click",()=>Qe("left"));en.addEventListener("click",()=>Qe("right"));st.addEventListener("click",()=>{const t=e.now_scene_data.btn[_];if(t){if(xe)return;e.sceneIndex=t,C(e.sceneIndex),wn()}});document.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"a":Qe("left");break;case"d":Qe("right");break;case"w":const n=e.now_scene_data.btn[_];n&&(e.sceneIndex=n,C(e.sceneIndex),wn());break}});function Qn(){if(!ee){ee=!0;for(let t=3;t>0;t--){const n=Yn(k.x,k.y,t);if(n.length>0){te=n;break}}}}function Yn(t,n,s){const i=[];for(let o=0;o<e.map.length;o++)for(let m=0;m<e.map[o].length;m++){if(e.map[o][m],!e.map[o][m].includes("L"))continue;Math.abs(t-m)+Math.abs(n-o)===s&&i.push({x:m,y:o})}return i}function xn(){te=te.map(({x:t,y:n})=>{const s=k.x-t,i=k.y-n;let o=t,m=n;return Math.abs(s)>Math.abs(i)?o=t+Math.sign(s):m=n+Math.sign(i),{x:o,y:m}})}function Ee(t,n){if(N.innerHTML="",N.appendChild(z),z.innerHTML="",t)switch(t){case"harm":lt("blood");const i=setTimeout(()=>{e.heart-=n,De.appendChild(ge),ge.textContent=`-${n}`,clearTimeout(i)},1e3);F=setTimeout(()=>{ke(),clearTimeout(i)},2e3),e.heart<0&&(e.heart=0,kt(),lt("dead"));break;case"heal":e.heart+=n,e.heart>e.heart_limit&&(e.heart=e.heart_limit),De.appendChild(ge),ge.textContent=`+${n}`;break}const s=i=>{const o=a(0,"user_each_state"),m=a(0,"user_state_icon"),c=a(0,"user_state_data"),u=a(0,"user_state_limit");if(m.id=`user_${i}_icon`,c.textContent=`${e[i]}`,u.textContent=` / ${e[`${i}_limit`]}`,i==="sanity"){const be=e.sanity/e.sanity_limit<.3?"user_state_icon sanity_danger":"user_state_icon sanity_safe";m.className=be}const b={heart:Me,sanity:ce};b[i].innerHTML="",b[i].append(c,u),o.append(m,b[i]),z.appendChild(o)};["heart","sanity"].forEach(s),t!=="init"&&z.append(tn,nn),Re.textContent=`${_}`}ge.addEventListener("animationend",()=>{De.innerHTML=""});ce.addEventListener("animationend",()=>{ce.className==="heart_jump"&&(ce.className="",zn(),console.log("use??"))});Me.addEventListener("animationend",()=>{Me.className==="heart_jump"&&(Me.className="",e.heart<=0&&(e.sanity-=1))});const Vn=t=>{switch(vn(),de.innerHTML="",de.append(Wt,qe,Ye),t){case"dead in fight":qe.textContent="the best wish, is dead alone";break;case 2:qe.textContent="end 2";break}};Ye.addEventListener("click",()=>{re.contains(de)&&re.removeChild(de),e.now_end=`${e.start_locat.x},${e.start_locat.y}`,e.sceneIndex=e.now_end});const Lt=(t,n)=>{switch(n){case"add":break;case"minus":e.scene_arr[e.sceneIndex].ux[t]=[];break}},d=t=>{re.appendChild(Ie),Ie.textContent=`${t.replace(/_/g," ")}`};Ie.addEventListener("animationend",t=>{t.animationName==="pop_anim"&&re.removeChild(Ie)});const ae=t=>{const n=document.querySelector("#scene_ux").children;t===!0?Array.from(n).forEach(s=>{s.style.pointerEvents="auto"}):t===!1&&Array.from(n).forEach(s=>{s.style.pointerEvents="none"})};let ve;const kn={1:"move_attack",2:"move_defense",3:"move_concentrate",4:"move_onslaught"};let O,ct;function Un(){v.innerHTML="",v.append(We,N),M.innerHTML="",M.appendChild(Fe),Fe.className="idle_move",We.innerHTML="",We.append(In,D,dn,fn,Ge,De),D.className=L.bg,e.enemy.heart=L.heart,Pe.textContent=e.enemy.heart,ve=0,G=kn[L.order[0]],ct=""}const _t=a("attack_idle","WEP_btn"),rt=a("defense_idle","WEP_btn");_t.addEventListener("click",()=>Et("attack","idle"));rt.addEventListener("click",()=>Et("defense","idle"));function ke(){d("your turn"),$.className="",he.innerHTML="",ye.innerHTML="",$e.innerHTML="",et.innerHTML="",he.append(_t,rt),_t.className="WEP_btn",rt.className="WEP_btn";let t=he,n=0;const s=new Set;for(const i in e.bag)if(!s.has(e.bag[i].name)&&(s.add(e.bag[i].name),g.effects[e.bag[i].name])){const o=a(0,`${e.bag[i].name} WEP_btn`),m=e.bag.filter(u=>u.name===e.bag[i].name).reduce((u,b)=>u+b.quantity,0),c=a(0,"WEP_num");c.textContent=m,o.innerHTML="",o.appendChild(c),o.addEventListener("click",()=>Et(g.effects[e.bag[i].name].is,e.bag[i].name)),n>=Fn&&(t===he?t=ye:t===ye&&(t=$e),n=0),t.appendChild(o),n++}$.innerHTML="",$.appendChild(he),ye.children.length>0&&$.appendChild(ye),$e.children.length>0&&$.appendChild($e),$.appendChild(et),et.append(hn,yn),v.appendChild($),Ee("init")}function Xn(t){hn.textContent=g[q].title[t],yn.textContent=g[q].info[t]}let dt;const mt=800;function Et(t,n){clearTimeout(O),$.className="weapon_column_lock",Xn(n),Fe.className=`${t}_${n}`,clearTimeout(O),O=setTimeout(()=>{switch(Fe.className="idle_move",Ge.innerHTML="",dt=t,t){case"attack":if(G==="move_defense"){d("enemy dodge!"),clearTimeout(O),O=setTimeout(()=>{pt()},mt);return}else{if(g.effects[n]&&g.effects[n].attack){const s=e.bag.filter(i=>i.name===n).sort((i,o)=>i.quantity-o.quantity||e.bag.indexOf(o)-e.bag.indexOf(i));if(s.length>0&&(s[0].quantity-=1,s[0].quantity<1)){const i=e.bag.indexOf(s[0]);i!==-1&&e.bag.splice(i,1)}e.enemy.harm=g.effects[n].attack}else e.enemy.harm=2;Ge.appendChild(ot),ot.textContent=`-${e.enemy.harm}`}break;case"heal":if(e.heart>=e.heart_limit)d("reach heart limit");else if(g.effects[n]&&g.effects[n].heal){const s=e.bag.filter(i=>i.name===n).sort((i,o)=>i.quantity-o.quantity||e.bag.indexOf(o)-e.bag.indexOf(i));if(s.length>0&&(s[0].quantity-=1,s[0].quantity<1)){const i=e.bag.indexOf(s[0]);i!==-1&&e.bag.splice(i,1)}Ee("heal",g.effects[n].heal)}break}O=setTimeout(()=>{pt()},mt)},400)}ot.addEventListener("animationend",()=>{if(Ge.innerHTML="",e.enemy.heart-=e.enemy.harm,Pe.textContent=`${e.enemy.heart}`,e.enemy.heart>0){clearTimeout(O),O=setTimeout(()=>{pt()},mt);return}else clearTimeout(O),e.enemy.heart=0,Pe.textContent=e.enemy.heart,d("win"),clearTimeout(F),Lt(0,"minus"),D.classList.add("enemy_faded_out"),$.className="weapon_column_lock",D.addEventListener("animationend",()=>{setTimeout(()=>{e.now_click_data.type==="boss"||(Ce(L.reward),v.contains($)&&v.removeChild($),M.innerHTML="",We.innerHTML="")},800)})});function pt(){switch(d("enemy turn"),clearTimeout(F),G){case"move_attack":je+=1,D.className=`${L.bg}-attack`,F=setTimeout(()=>{D.className=L.bg},800),dt==="defense"?(d("defense sucess"),F=setTimeout(()=>{ke()},1e3)):Ee("harm",L.attack);break;case"move_defense":F=setTimeout(()=>{ke()},1e3);break;case"move_concentrate":je+=1,F=setTimeout(()=>{ke()},1e3);break;case"move_onslaught":je=0,dt==="defense"&&d("defense fail"),D.className=`${L.bg}-onslaught`,F=setTimeout(()=>{D.className=L.bg},800),Ee("harm",L.attack*2);break}pn.className=ct,mn.className=G,ct=G,je>=3?G="move_onslaught":(ve++,ve>=L.order.length&&(ve=0),G=kn[L.order[ve]]),un.className=G}const Ce=(t,n)=>{fe(),I.style.display="flex",ne.textContent="Reward",W.innerHTML="",Oe=!0,Object.keys(t).forEach(s=>{if(t[s]>0){const i=a(0,"item_slot"),o=a(0,"bag_item_num");o.textContent=t[s],i.classList.add(String(s)),i.appendChild(o),W.appendChild(i),i.addEventListener("click",()=>{if(!me(e.bag,{name:s,quantity:1},e.bag_space)){d("Bag is full");return}d(`Added 1 ${s} to your bag`),se(s),K.innerHTML="",K.appendChild(Ae),P(),event.target.style.display="none"})}})};X.addEventListener("animationend",()=>{M.removeChild(X),X.className==="sanity_efx"?C("dream_start"):X.className==="dead_efx"&&C("dead")});const zn=()=>{e.sanity-=1,ce.className="heart_jump",e.sanity<=0&&(Bn.innerHTML="",e.last_scene_index=e.sceneIndex,M.appendChild(X),L.type==="boss"?X.className="dead_efx":X.className="sanity_efx"),ce.textContent=`${e.sanity} / ${e.sanity_limit}`},Jn=t=>{let n;Z.innerHTML="",t==="battle"?(d("Allright"),C("dream_battle")):(Math.random()<.5?(j.className="s1-dream-left",n="left"):(j.className="s1-dream-right",n="right"),setTimeout(()=>{n===t?(d("You made the right choice!"),C("dream_correct")):(d("Wrong choice!"),C("dream_wrong"))},2e3)),e.sanity=e.sanity_limit};let h;pe.addEventListener("click",()=>{const t=()=>{N.innerHTML="",N.appendChild(z),ut=!1,jt=!1,Ue=!1,Xe=!1,h&&h!==null&&h!==void 0&&(h.length>0&&d(`${f} recieve ${r.name}`),h=[],Je())};Oe&&(Oe=!1,t(),Z.innerHTML="",j.className="",C(e.sceneIndex)),y.style.display==="none"&&t(),y.className="object_div_fade",y.addEventListener("animationend",()=>{y.className==="object_div_fade"&&(y.style.display="none"),y.className=""}),ae(!0)});const se=(t,n)=>{y.className="",y.style.display="flex",y.innerHTML="",K.innerHTML="",J.innerHTML="",E.innerHTML="",y.append(K,J),K.append(Ae,E,cn),J.append(Ht),Ae.textContent=g[q].title[t],Ht.textContent=g[q].info[t],ft.textContent=String(p),n&&Ne(n)};function me(t,n,s){const i=g.effects[n.name].limit;let o=n.quantity;const m=Math.ceil(o/i);if(t.length+m>s)return!1;for(t.forEach(c=>{if(c.name===n.name&&c.quantity<i){const u=i-c.quantity;if(o<=u){c.quantity+=o,o=0;return}else c.quantity=i,o-=u}});o>0;){const c=Math.min(o,i);t.push({name:n.name,quantity:c}),o-=c}return!0}function Kn(){fe(),ne.textContent="Craft",I.style.display="flex",W.innerHTML="",Object.keys(V).forEach(t=>{const n=a(0,"item_slot");n.classList.add(t),W.appendChild(n),n.addEventListener("click",R(()=>{se(t),Hn.appendChild(Sn),r=t;const s=a("obj_recipe_1_btn","object_btns");if(s.innerHTML=`Recipe 1:<br> ${V[t][1].map(i=>`${i.quantity}x ${g[q].title[i.name]}`).join("<br>")}`,s.addEventListener("click",()=>nt(t,1)),J.innerHTML="",J.appendChild(s),V[t][2]){const i=a("obj_recipe_2_btn","object_btns");i.innerHTML=`Recipe 2:<br> ${V[t][2].map(o=>`${o.quantity}x ${g[q].title[o.name]}`).join("<br>")}`,i.addEventListener("click",()=>nt(t,2)),J.appendChild(i)}if(V[t][3]){const i=a("obj_recipe_3_btn","object_btns");i.innerHTML=`Recipe 3:<br> ${V[t][3].map(o=>`${o.quantity}x ${g[q].title[o.name]}`).join("<br>")}`,i.addEventListener("click",()=>nt(t,3)),J.appendChild(i)}}),300)})}function nt(t,n){const s=V[t][n];if(!s.every(m=>e.bag.filter(u=>u.name===m.name).reduce((u,b)=>u+b.quantity,0)>=m.quantity)){d("Don't have all required items.");return}if(s.forEach(m=>{let c=m.quantity;console.log("Remain: ",c);for(let u=0;u<e.bag.length;u++){const b=e.bag[u];if(b.name===m.name){if(console.log(`扣除前: ${b.name}, 數量: ${b.quantity}, 需扣除: ${c}`),b.quantity>c){b.quantity-=c,c=0,console.log(`扣除後: ${b.name}, 數量: ${b.quantity}, remain: ${c}`);break}else c-=b.quantity,e.bag.splice(u,1),u--,console.log(`移除物品: ${b.name}, remain: ${c}`);if(c<=0)break}}}),!me(e.bag,{name:t,quantity:1},e.bag_space)){d("Bag is full");return}d(`${t} crafted successfully!`),P()}let Ct=!1;function Zn(){fe(),I.style.display="flex",H.style.display="flex";let t=St[q];ne.textContent=t[f],H.textContent=`Trust: ${e.trust[f]} +`,W.innerHTML="",Object.keys(Le).forEach(n=>{const s=a(0,"item_slot");s.classList.add(n),W.appendChild(s),s.addEventListener("click",()=>{Ct=!1,r={},r.name=n,se(n,10),E.innerHTML="",E.appendChild(bt),H.textContent=`Trust: ${e.trust[f]} - ${Le[n]}`})})}f=bt.addEventListener("click",R(()=>{if(e.trust[f]<Le[r.name]*p){d("Trust not enough");return}if(!me(e.bag,{name:r.name,quantity:p},e.bag_space)){d("Bag is full");return}d(`add ${p} ${r.name} in your bag`),e.trust[f]-=Le[r.name]*p,H.textContent=`Trust: ${e.trust[f]}`,P()},300));function ea(){Ue=!0,fe(),ne.textContent="Inventory",I.style.display="flex",Nt()}function Nt(){W.innerHTML="";for(let t=0;t<e.inventory_space;t++){const n=a(0,"item_slot");if(_e[t]){const s=_e[t];n.classList.add(s.name);const i=a(0,"bag_item_num");i.textContent=`${s.quantity}`,n.appendChild(i),n.addEventListener("click",()=>{r=t,se(s.name,s.quantity),E.innerHTML="",E.appendChild(Ve)})}W.appendChild(n)}}Ve.addEventListener("click",R(()=>{if(_e[r]&&Ue){const t=_e[r];if(!me(e.bag,{name:t.name,quantity:p},e.bag_space)){d("Bag is full");return}d(`Added ${p} ${t.name} to your bag`),t.quantity>p?t.quantity-=p:(_e.splice(r,1),y.style.display="none"),Ne(t.quantity),Nt()}else if(h&&Xe){const t=h[0];if(!me(e.bag,{name:t.name,quantity:1},e.bag_space)){d("Bag is full");return}d(`Added 1 ${t.name} to your bag`),h=[],y.style.display="none",Ne(t.quantity),Je()}P()},300));function ta(){fe(),Xe=!0,ne.textContent="Share",I.style.display="flex",Je()}function Je(){W.innerHTML="";const t=a(0,"item_slot");W.appendChild(t),console.log(h),h&&h.length>0&&(t.classList.add(h[0].name),console.log(h[0].name),t.addEventListener("click",()=>{r=h[0],se(h[0].name,1),E.innerHTML="",E.appendChild(Ve)}))}nn.addEventListener("click",R(()=>{ut?pe.click():fe()},300));const fe=()=>{ut=!0,ae(!1),y.style.display="none",I.style.display="none",H.style.display="none",N.innerHTML="",N.append(pe,z,an,y,I),T.appendChild(N),P()};function P(){He.innerHTML="";for(let t=0;t<e.bag_space;t++){const n=a(0,"item_slot");if(e.bag[t]){const s=e.bag[t];n.classList.add(s.name);const i=a(0,"bag_item_num");i.textContent=`${s.quantity}`,n.appendChild(i),n.addEventListener("click",()=>{if(s)if(r=s,Ue===!0){if(!me(_e,{name:s.name,quantity:s.quantity},e.inventory_space)){d("Inventory is full");return}e.bag.splice(t,1),Nt(),P()}else if(Xe===!0){if(h&&h!==null&&h!==void 0&&h.length>0){d("already have stuff");return}s.quantity<=1?e.bag.splice(t,1):s.quantity-=1,h=[{name:s.name,quantity:1}],d(`share 1 ${s.name}`),Je(),P()}else se(s.name,s.quantity),H.style.display==="flex"?(Ct=!0,E.appendChild(ht),H.textContent=`Trust: ${e.trust[f]} + ${xt[s.name]}`):Oe===!0?E.appendChild(yt):E.appendChild(gt)})}if(He.children.length>=e.bag_space)break;He.appendChild(n)}}yt.addEventListener("click",R(()=>{r.quantity>p?r.quantity-=p:(e.bag.splice(e.bag.indexOf(r),1),y.style.display="none"),Ne(r.quantity),P()},300));ht.addEventListener("click",R(()=>{r.quantity>p?r.quantity-=p:(e.bag.splice(e.bag.indexOf(r),1),y.style.display="none"),e.trust[f]+=xt[r.name]*p,H.textContent=`Trust: ${e.trust[f]}`,Ne(r.quantity),P()},300));gt.addEventListener("click",()=>{r.quantity>p?r.quantity-=p:(e.bag.splice(r,1),y.style.display="none")});function Ne(t){p=1,wt=t,Tt()}function Tt(){ft.textContent=String(p);let t,n;Ct?(t="+",n=xt[r.name]*p):(t="-",n=Le[r.name]*p),H.textContent=`Trust: ${e.trust[f]} ${t} ${n}`}_n.addEventListener("click",R(()=>{p<wt?p+=1:p=1,Tt()}),300);rn.addEventListener("click",R(()=>{p>1?p-=1:p=wt,Tt()}),300);tn.addEventListener("click",R(()=>{jt?pe.click():na()},300));let jt=!1;const na=()=>{jt=!0,ae(!1),y.style.display="none",I.style.display="none",H.style.display="none",N.innerHTML="",N.append(pe,z,on,y,I),T.appendChild(N),aa()};function aa(){it.innerHTML="";for(let t=0;t<e.album.length;t++){const n=a(0,"item_slot");if(e.album[t]){const s=e.album[t];n.classList.add(s.name),n.addEventListener("click",()=>{s&&(r=s,se(s.name),K.innerHTML="",K.append(Ae,E,we),E.appendChild(vt),we.className=s.name)})}it.appendChild(n)}}vt.addEventListener("click",()=>{switch(y.style.display="none",pe.click(),f){case"harvey":d(`You ask ${f} for the ${we.className}`),console.log(),e.line_length=Object.keys(e[`${f}_line`][we.className]).length,e.line_rp=e[`${f}_line`][we.className],A(e.line_length);break;default:d("nobody response");break}});It.addEventListener("click",R(()=>{A(e.line_length)},300));const Ln=()=>{S.className="lines_passing",Rt=setTimeout(()=>{e.line_length=0,A(e.line_length),S.className=""},500)},Ke=()=>{S.className="",clearTimeout(Rt)};S.addEventListener("mousedown",Ln);S.addEventListener("touchstart",Ln);S.addEventListener("mouseup",Ke);S.addEventListener("mouseleave",Ke);S.addEventListener("touchend",Ke);S.addEventListener("touchcancel",Ke);function a(t,n){const s=document.createElement("div");return t&&(s.id=t),n&&(s.className=n),s}function R(t,n=100){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>t.apply(this,i),n)}}const B=a("cursor");re.appendChild(B);B.style.display="none";function En(t){B.style.display="flex",B.className="click_anim";const{pageX:n,pageY:s}=t;B.style.left=`${n-B.offsetWidth/2}px`,B.style.top=`${s-B.offsetHeight/2}px`;const i=setTimeout(()=>{B.style.display="none",clearTimeout(i)},200)}document.addEventListener("mousedown",En);document.addEventListener("touchstart",t=>{En(t.touches[0])});export{An as click_ux,A as new_line,gn as new_scene,ia as next_scene_btn,Y as render_ux,e as user};
